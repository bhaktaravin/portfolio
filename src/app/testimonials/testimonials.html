<div class="container">
  <h2 class="section-title">Testimonials
    <button class="add-btn" (click)="showForm = !showForm" title="Add Testimonial">+</button>
  </h2>
  <div *ngIf="showForm" class="testimonial-form-wrapper">
    <form (ngSubmit)="submitTestimonial()" #testimonialForm="ngForm">
      <input type="text" name="name" [(ngModel)]="newTestimonial.name" placeholder="Your Name" required />
      <input type="email" name="email" [(ngModel)]="newTestimonial.email" placeholder="Email (for Gravatar)" />
      <input type="text" name="title" [(ngModel)]="newTestimonial.title" placeholder="Your Title/Role" required />
      <input type="text" name="date" [(ngModel)]="newTestimonial.date" placeholder="Date (e.g. Dec 2025)" required />
      <input type="text" name="relationship" [(ngModel)]="newTestimonial.relationship" placeholder="Relationship (e.g. Colleague)" required />
      <textarea name="text" [(ngModel)]="newTestimonial.text" placeholder="Your Testimonial" required></textarea>
      <input type="text" name="image" [(ngModel)]="newTestimonial.image" placeholder="Image URL (optional)" />
      <button type="submit" [disabled]="testimonialForm.invalid">Submit</button>
      <button type="button" (click)="showForm = false">Cancel</button>
    </form>
  </div>
  <div class="testimonials-grid">
    <div class="testimonial-card" *ngFor="let testimonial of testimonials$ | async">
      <div class="testimonial-header">
        <img *ngIf="testimonial.image; else gravatarBlock" [src]="testimonial.image" class="testimonial-avatar" alt="{{testimonial.name}}" />
        <ng-template #gravatarBlock>
          <img *ngIf="testimonial.email" [src]="gravatarUrl(testimonial.email)" class="testimonial-avatar" alt="{{testimonial.name}}" />
        </ng-template>
        <div class="testimonial-meta">
          <span class="testimonial-name">{{ testimonial.name }}</span>
          <span class="testimonial-title">{{ testimonial.title }}</span>
          <span class="testimonial-date">{{ testimonial.date }}</span>
          <span class="testimonial-relationship">{{ testimonial.relationship }}</span>
        </div>
        <button class="delete-btn" *ngIf="testimonial.id" (click)="deleteTestimonial(testimonial.id)" title="Delete Testimonial">x</button>

      </div>
      <div class="testimonial-content">
        <p class="testimonial-text">{{ testimonial.text }}</p>
      </div>
    </div>
  </div>
</div>
